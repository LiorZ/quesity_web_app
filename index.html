<html>
<head>
<!--  CSS Includes: -->
	<link rel="stylesheet" href="js/lib/jquery-ui/css/smoothness/jquery-ui-1.10.0.custom.css" />
<link rel="stylesheet" href="js/lib/jquery-ui/plugins/tablesorter/themes/blue/style.css" type="text/css" id="" media="print, projection, screen" />

<!-- Javascript includes: -->
<script type="text/javascript" src="js/lib/jquery/jquery.1.9.0.js"></script>
<script type="text/javascript" src="js/lib/utils/utils.js"></script>

<script type="text/javascript" src="js/lib/jointjs/raphael.js"></script>
<script type="text/javascript" src="js/lib/jquery-ui/plugins/jquery-easing/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="js/lib/jquery-ui/plugins/horizontal-accordion/liteaccordion.jquery.js"></script>
<script type="text/javascript" src="js/lib/jointjs/joint.js"></script>
<script type="text/javascript" src="js/lib/jointjs/json2.js"></script>
<script type="text/javascript" src="js/lib/jointjs/joint.dia.js"></script>
<script type="text/javascript" src="js/lib/jointjs/joint.dia.uml.js"></script>

<script type="text/javascript" src="js/lib/jointjs/joint.dia.org.js"></script>

<script src="js/lib/jquery-ui/jquery-ui-1.10.0.custom.js"></script>

<script src="js/lib/underscore/underscore.js"></script>
<script src="js/lib/jquery-ui/plugins/tablesorter/jquery.tablesorter.js"></script>

<script src="js/lib/backbone/backbone.js"></script>
<!--  The app itself -->
<script type="text/javascript" src="js/views/appView.js"></script>

<script type="text/javascript" src="js/app.js"></script>
<script type="text/javascript" src="js/routers/Router.js"></script>

<script type="text/javascript" src="js/views/MenuView.js"></script>

<script type="text/javascript" src="js/views/EditableRowView.js"></script>
<script type="text/javascript" src="js/views/EditableTableView.js"></script>
<script type="text/javascript" src="js/views/EditableRowDialog.js"></script>
<script type="text/javascript" src="js/views/LinkEditableRowDialog.js"></script>
<script type="text/javascript" src="js/views/LinkEditableRowView.js"></script>
<script type="text/javascript" src="js/views/LinkView.js"></script>



<script type="text/javascript" src="js/views/appView.js"></script>
<script type="text/javascript" src="js/views/QuestPagePropertiesView.js"></script>

<script type="text/javascript" src="js/views/QuestPageDiagramView.js"></script>
<script type="text/javascript" src="js/views/QuestPageLocationPropertiesView.js"></script>
<script type="text/javascript" src="js/views/QuestPageQuestionPropertiesView.js"></script>
<script type="text/javascript" src="js/views/QuestPageStaticPropertiesView.js"></script>
<script type="text/javascript" src="js/views/QuestPageSurprisePropertiesView.js"></script>



<script type="text/javascript" src="js/models/Hint.js"></script>
<script type="text/javascript" src="js/models/Link.js"></script>
<script type="text/javascript" src="js/models/LinkLocation.js"></script>

<script type="text/javascript" src="js/models/LinkAnswer.js"></script>
<script type="text/javascript" src="js/models/QuestPage.js"></script>
<script type="text/javascript" src="js/models/QuestPageLocation.js"></script>
<script type="text/javascript" src="js/models/QuestPageStatic.js"></script>
<script type="text/javascript" src="js/models/QuestPageSurprise.js"></script>
<script type="text/javascript" src="js/models/QuestPageQuestion.js"></script>
<script type="text/javascript" src="js/models/Mixins.js"></script>



<script type="text/javascript" src="js/models/QuestPageCollection.js"></script>


<title>Quesity Editor</title>
<style type="text/css">
#menu {
	position: relative;
	left:-600;
}

#new_page_menu{
	width:150px;
	display:none;
	position:absolute;
}

.smaller_fonts {
	font-size:12px;
}
.btn_connection {
	display:inline;
	position:absolute;
	background-image: url("img/arrow_icon.png");
	background-size: 20px;
	width:20px;
	height:20px;
}
#toolbar {
		padding: 4px;
		display: inline-block;
		display:none;
		position:absolute;
	}
#page_number{ 
  border-radius: 55em;
  -moz-border-radius: 55em;
  -webkit-border-radius: 55em;
  border:3px solid black;
  display: inline-block;
  font-weight: bold;
  line-height: 3em;
  margin-right: 5px;
  text-align: center;
  width: 6em; 
}
body {
   background:url(
   
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIUlEQVQYV2NkYGDwAeIthGhGoAKiAEghzES8GkZNxBs8ALOvCQtmZ8UqAAAAAElFTkSuQmCC   ) repeat;
}

.quest_page {
	border: 1px solid black;
	border-radius: 30px;
	display: 'inline';
	background: transparent;
	background-color:rgba(189,223,255,0.8);
	position: fixed;
	padding: 20px;
}
#page_symbol {
	position: absolute;
	float: right;
	height:100px;
	margin-right:1em;
	right: 0px;
}
#page_symbol td {
	text-align: center;
}
#page_symbol img {
	height:100px;
}

#links{ 
	float:right;
	width:25%;
}
#dialog_form input, #dialog_form label {
	display: block;
}

#page_title_text {
	background-color:rgba(189,223,255,0);
	font-size: 2em;
	border: 0px;
	text-align: center;
}
</style>
<script type="text/javascript">
$("document").ready(function(){

	var org = Joint.dia.org;
		Joint.paper("world");

		$( "button" ).button();
		$("#menu_opener").mouseenter(function(e){
			e.preventDefault();
			this.blur();
			$("#menu").animate({left:0}, {duration: 1000, complete:function() {
				$("#menu_opener span").text("<<")
			}});
		});
		$("#menu").mouseleave(function(e){
			e.preventDefault();
			this.blur();
			 $("#new_page_menu").css('display','none');
			$("#menu").animate({left:-600}, {duration: 1000, complete: function() {
				$("#menu_opener span").text(">>")
			}});

		});
		
		$("#btn_new_page").click(function(e){
			var menu = $("#new_page_menu")
			menu.css('display','block');
			menu.offset({left:$("#btn_new_page").offset().left})
			
		});
		
		$("#new_page_menu").menu();
		$("#new_page_menu li").click(function(e) {
			console.log(this)
		});
		
		});
</script>
<body>
<div id='container'>
<div id="menu">
	<button>Settings</button>
	<button id="btn_new_page">New Page</button>
	<button>Demo</button>
	<button>Publish</button>
	<button>Exit Editor</button>
	<button id="menu_opener" class="smaller_fonts">&gt;&gt; </button>
	<ul id="new_page_menu" class="smaller_fonts">
	<li><a href="#show_diagram" data-page-type='location'>Location based page</a></li>
	<li><a href="#show_diagram" data-page-type='question'>Question page</a></li>
	<li><a href="#show_diagram" data-page-type='static'>Static page</a></li>
	<li><a href="#show_diagram" data-page-type='surprise'>Surprise page</a></li>
	<li><a href="#show_diagram" data-page-type='stall'>Stall page</a></li>
</ul>
</div>

<div id="toolbar" class="ui-widget-header ui-corner-all">
	<button id="btn_delete" class='smaller_fonts'>Delete page</button>
	<button id="btn_edit" class='smaller_fonts'>Edit page</button>
</div>

<div id='world' style="height:100%">
	
</div> <!-- world -->

</div> <!-- Container -->
 <script type='text/template' id='tmpl_header'>
<div id='quest_page_title' style='text-align:center'>
	<table id='page_symbol'><tr><td><img src='img/location_icon.png'/></td></tr><tr><td id='type_title'></td></tr></table>
	<span id='page_number'><h1><%=page_number%> </h1></span>
	<div text-align:'center'><input id='page_title_text'  type="text" value="<%=page_name%>"/></div>
<div id='links'>

</script>
<script type='text/template' id='tmpl_locations'>
<table id="locations" class="tablesorter"> 
<thead> 
<tr> 
    <th>Location</th> 
    <th>Leads to page</th> 
    <th> </th> 
</tr> 
</thead> 
<tbody> 
<tr> 
    <td>Smith</td> 
    <td>John</td> 
    <td><button>X</button></td>

</tr> 
<tr> 
    <td>Bach</td> 
    <td>Frank</td> 
    <td><button>X</button></td> 
</tr> 
<tr> 
    <td>Doe</td> 
    <td>Jason</td> 
    <td><button>X</button></td> 
</tr> 
<tr> 
    <td>Conway</td> 
    <td>Tim</td> 
    <td><button>X</button></td> 
</tr> 
</tbody>
</table>
<div style='float:right'><button id='btn_add_location'>Add</button></div>
</script>

<script type='text/template' id='tmpl_answers'>
<table id="answers" class="tablesorter"> 
<thead> 
<tr> 
    <th>Answer</th> 
    <th>Leads to page</th> 
	<th>Delete</th>
</tr> 
</thead> 
<tbody id='row_table_body'> 
</tbody>
</table>
<div style='float:right'><button id='btn_add_row'>Add</button></div>
</script>

<script type='text/template' id='tmpl_static_links'>
<table id="tbl_links" class="tablesorter"> 
<thead> 
<tr> 
    <th>Leads to page</th> 
	<th>Delete</th>
</tr> 
</thead> 
<tbody id='row_table_body'> 
</tbody>
</table>
<div style='float:right'><button id='btn_add_row'>Set Link</button></div>
</script>

<script type='text/template' id='tmpl_one_link'>
	<td><a href='#' id='lnk_edit_row'><a href='#page/<%= links_to_page.get('page_number') %>' id='lnk_links_to_page'><%= links_to_page.get('page_number') %> - <%=links_to_page.get('page_name')%></a></a></td>
	<td><button id='btn_delete_row' class='btn_delete_hint'>X</button>
</script>

<script type='text/template' id='tmpl_one_hint'>
	<td><a href='#' id='lnk_edit_row'><%=hint_title%></a></td>
	<td><button id='btn_delete_row' class='btn_delete_hint'>X</button>
</script>

<script type='text/template' id='tmpl_one_answer'>
	<td><a href='#' id='lnk_edit_row'><%=answer_txt%></a></td>
	<td>
			<%if ( links_to_page ) %> 
				<a href='#page/<%= links_to_page.get('page_number') %>' id='lnk_links_to_page'><%= links_to_page.get('page_number') %> - <%=links_to_page.get('page_name')%></a>
			<%else { %> N/A </td> <% } %>
	<td><button id='btn_delete_row' class='btn_delete_hint'>X</button></td>
</script>

<script type='text/template' id='tmpl_hints'>
<table id="hints" class="tablesorter"> 
<thead> 
<tr> 
    <th>Hint</th> 
    <th> </th> 
</tr> 
</thead> 
<tbody id='row_table_body'> 

</tbody> 
</table> 
<div style='float:right'><button id='btn_add_row'>Add</button></div>
</script>

<script type='text/template' id='tmpl_page_location'>
	<%= _.template($('#tmpl_header').html())(data) %>
	<%= _.template($('#tmpl_locations').html())(data) %>
	<div id='hint_place_holder'></div>
<br/>
<button id='btn_exit_prop'>Back to diagram</button>

</div>
</div>
</script>

<script type='text/template' id=tmpl_page_question>
	<%= _.template($('#tmpl_header').html())(data) %>
	<div id='answers_place_holder'></div>
	<div id='hint_place_holder'></div>
<br/>
<button id='btn_exit_prop'>Back to diagram</button>

</div>
</div>
</script>

<script type='text/template' id=tmpl_page_surprise>
	<%= _.template($('#tmpl_header').html())(data) %>
	<div id='location_place_holder'></div>
	<div id='hint_place_holder'></div>
<br/>
<button id='btn_exit_prop'>Back to diagram</button>

</div>
</div>
</script>

<script type='text/template' id='tmpl_page_static'>
	<%= _.template($('#tmpl_header').html())(data) %>
	<div id='link_place_holder'></div>

<button id='btn_exit_prop'>Back to diagram</button>

</div>
</div>
</script>

<script type='text/template' id=tmpl_hint_dialog>

<div id="dialog_form" title="Add New Hint">
  <form>
  <fieldset>
    <label for="txt_hint_title">Title:</label>
  	<input type="text" name="txt_hint_title" id="txt_hint_title" class="text ui-widget-content ui-corner-all" value="<%=hint_title%>"/>
    <label for="txt_hint">Hint:</label>
    <textarea type="text" name="txt_hint" id="txt_hint" class="text ui-widget-content ui-corner-all"><%=hint_txt%></textarea>
  </fieldset>
  </form>
</div>
</script>

<script type='text/template' id=tmpl_answer_dialog>

<div id="dialog_form" title="Add New answer">
  <form>
  <fieldset>
    <label for="txt_hint_title">Answer:</label>
  	<input type="text" name="txt_answer" id="txt_answer" class="text ui-widget-content ui-corner-all"  value='<%=answer_txt%>' />
    <label for="next_page_link">This answer links to page:</label>

  	<select id='next_page_link' name='next_page_link'>
	<% utils.get_linkable_pages(parent_page).each( function(page) { %>
		<option value='<%= page.get('page_number')%>'><%=page.get('page_number') %> - <%=page.get('page_name') %></option>
	<% }); %>
	</select>
  </fieldset>
  </form>
</div>
</script>

<script type='text/template' id=tmpl_set_link_dialog>

<div id="dialog_form" title="Set Link">
  <form>
  <fieldset>
    <label for="next_page_link">Set the next page:</label>

  	<select id='next_page_link' name='next_page_link'>
	<% utils.get_linkable_pages(parent_page).each( function(page) { %>
		<option value='<%= page.get('page_number')%>'  
		<% 
		var links = parent_page.get('links');
		if ( links.length >0 ) {
			var only_page = links.at(0).get('links_to_page'); 
			console.log("only page:");
			console.log(only_page);
			
			console.log(page);
			if ( only_page == page ) { %>
				selected
		<% } } %>
 ><%=page.get('page_number') %> - <%=page.get('page_name') %>
		 </option>
	<% }); %>
	</select>
  </fieldset>
  </form>
</div>
</script>
</body>
</head>
</html>